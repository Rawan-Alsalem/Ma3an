{% extends 'main/base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="{% static 'css/agency.css' %}">

<div class="container py-5">
    
    <div class="stepper-wrapper mb-5">
        <div class="stepper-item completed"><div class="step-counter"><i class="fas fa-check"></i></div><div class="step-name">Tour Info</div></div>
        <div class="stepper-item completed"><div class="step-counter"><i class="fas fa-check"></i></div><div class="step-name">Schedule</div></div>
        <div class="stepper-item active"><div class="step-counter">3</div><div class="step-name">Confirm</div></div>
    </div>

    <div class="row g-4">
        <div class="col-lg-8">
            <div class="detail-card shadow-sm mb-4">
                <div class="detail-image-wrapper">
                    {% if tour.image %}
                        <img src="{{ tour.image.url }}" class="img-main" alt="{{ tour.name }}">
                    {% else %}
                        <img src="https://images.unsplash.com/photo-1566073771259-6a8506099945?w=1200" class="img-main">
                    {% endif %}
                </div>
                
                <div class="p-4">
                    <h2 class="fw-bold mb-3">{{ tour.name }}</h2>
                    <div class="d-flex gap-3 mb-4 text-muted">
                        <span><i class="fas fa-map-marker-alt text-primary me-1"></i> {{ tour.city }}, {{ tour.country }}</span>
                        <span><i class="fas fa-users text-primary me-1"></i> {{ tour.travelers }} Travelers</span>
                    </div>
                    <h5 class="fw-bold">Description</h5>
                    <p class="text-secondary">{{ tour.description }}</p>
                </div>
            </div>

            <h4 class="fw-bold mb-4 mt-5"><i class="far fa-map me-2"></i>Tour Itinerary</h4>
            
            <div class="modern-timeline">
                {% regroup schedules by day_number as schedules_by_day %}
                
                {% for day in schedules_by_day %}
                    <div class="timeline-day-header">
                        <span class="day-label">Day {{ day.grouper }}</span>
                    </div>

                    {% for schedule in day.list %}
                        <div class="timeline-event">
                            <div class="timeline-line"></div>
                            <div class="timeline-dot"></div>
                            
                            <div class="timeline-content-card shadow-sm">
                                <div class="event-time">
                                    <i class="far fa-clock me-1"></i> {{ schedule.start_time }} - {{ schedule.end_time }}
                                </div>
                                <div class="event-details">
                                    <h6 class="fw-bold text-dark mb-1">{{ schedule.activity_title }}</h6>
                                    <p class="text-muted small mb-2">{{ schedule.description }}</p>
                                    <div class="event-location">
                                        <i class="fas fa-map-marker-alt me-1"></i> {{ schedule.location_name }}
                                        {% if schedule.location_url %}
                                            <a href="{{ schedule.location_url }}" target="_blank" class="map-link">View Map</a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                {% empty %}
                    <div class="alert alert-light text-center border">No schedule added yet.</div>
                {% endfor %}
            </div>
        </div>

        <div class="col-lg-4">
            <div class="summary-card shadow-sm sticky-top" style="top: 20px;">
                <h5 class="fw-bold mb-4 border-bottom pb-2">Review Summary</h5>
                <ul class="list-unstyled">
                    <li class="d-flex justify-content-between mb-3">
                        <span class="text-muted">Start</span> <span class="fw-bold">{{ tour.start_date }}</span>
                    </li>
                    <li class="d-flex justify-content-between mb-3">
                        <span class="text-muted">End</span> <span class="fw-bold">{{ tour.end_date }}</span>
                    </li>
                    <li class="d-flex justify-content-between mb-4">
                        <span class="text-muted">Price</span> <span class="fw-bold text-success h5 mb-0">{{ tour.price }} SAR</span>
                    </li>
                </ul>

                <form action="{% url 'agency:confirm_tour' tour.id %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success w-100 rounded-pill py-3 fw-bold mb-3 shadow">
                        <i class="fas fa-check-circle me-2"></i> Confirm & Publish
                    </button>
                </form>
                
                <a href="{% url 'agency:dashboard' %}" class="btn btn-outline-primary w-100 rounded-pill mb-2">Back to Dashboard</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}